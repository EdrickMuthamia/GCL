<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCL Analytics Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .dashboard { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat { text-align: center; padding: 20px; background: #ff6b35; color: white; border-radius: 8px; }
        .log-entry { padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; }
        .timestamp { color: #666; font-size: 12px; }
        button { background: #ff6b35; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #e55a2b; }
        .filter { margin: 10px 0; }
        select, input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>GCL Construction Equipment - Analytics Dashboard</h1>
        
        <div class="card">
            <h2>Quick Stats</h2>
            <div class="stats">
                <div class="stat">
                    <h3 id="totalLogs">0</h3>
                    <p>Total Interactions</p>
                </div>
                <div class="stat">
                    <h3 id="uniqueSessions">0</h3>
                    <p>Unique Sessions</p>
                </div>
                <div class="stat">
                    <h3 id="formSubmissions">0</h3>
                    <p>Form Submissions</p>
                </div>
                <div class="stat">
                    <h3 id="avgTimeSpent">0s</h3>
                    <p>Avg Time Spent</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Log Filters</h2>
            <div class="filter">
                <select id="actionFilter">
                    <option value="">All Actions</option>
                    <option value="page_load">Page Loads</option>
                    <option value="navigation_click">Navigation Clicks</option>
                    <option value="form_submission">Form Submissions</option>
                    <option value="equipment_interest">Equipment Interest</option>
                    <option value="section_view">Section Views</option>
                </select>
                <input type="date" id="dateFilter">
                <button onclick="applyFilters()">Apply Filters</button>
                <button onclick="clearFilters()">Clear Filters</button>
                <button onclick="exportLogs()">Export CSV</button>
                <button onclick="clearAllLogs()">Clear All Logs</button>
            </div>
        </div>

        <div class="card">
            <h2>Recent Activity</h2>
            <div id="logContainer">
                <p>No logs available. Visit the main website to generate activity data.</p>
            </div>
        </div>
    </div>

    <script>
        let allLogs = [];
        let filteredLogs = [];

        function loadLogs() {
            allLogs = JSON.parse(localStorage.getItem('gclLogs') || '[]');
            filteredLogs = [...allLogs];
            updateStats();
            displayLogs();
        }

        function updateStats() {
            document.getElementById('totalLogs').textContent = allLogs.length;
            
            const uniqueSessions = new Set(allLogs.map(log => log.timestamp.split('T')[0])).size;
            document.getElementById('uniqueSessions').textContent = uniqueSessions;
            
            const formSubs = allLogs.filter(log => log.action === 'form_submission').length;
            document.getElementById('formSubmissions').textContent = formSubs;
            
            const sessionEnds = allLogs.filter(log => log.action === 'session_end');
            const avgTime = sessionEnds.length > 0 
                ? Math.round(sessionEnds.reduce((sum, log) => sum + (log.details.timeSpent || 0), 0) / sessionEnds.length)
                : 0;
            document.getElementById('avgTimeSpent').textContent = avgTime + 's';
        }

        function displayLogs() {
            const container = document.getElementById('logContainer');
            
            if (filteredLogs.length === 0) {
                container.innerHTML = '<p>No logs match the current filters.</p>';
                return;
            }

            container.innerHTML = filteredLogs
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 100)
                .map(log => `
                    <div class="log-entry">
                        <div class="timestamp">${new Date(log.timestamp).toLocaleString()}</div>
                        <strong>${log.action.replace('_', ' ').toUpperCase()}</strong>
                        ${log.details ? `- ${JSON.stringify(log.details)}` : ''}
                    </div>
                `).join('');
        }

        function applyFilters() {
            const actionFilter = document.getElementById('actionFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            filteredLogs = allLogs.filter(log => {
                const matchesAction = !actionFilter || log.action === actionFilter;
                const matchesDate = !dateFilter || log.timestamp.startsWith(dateFilter);
                return matchesAction && matchesDate;
            });
            
            displayLogs();
        }

        function clearFilters() {
            document.getElementById('actionFilter').value = '';
            document.getElementById('dateFilter').value = '';
            filteredLogs = [...allLogs];
            displayLogs();
        }

        function exportLogs() {
            const csv = [
                ['Timestamp', 'Action', 'Details', 'User Agent'],
                ...filteredLogs.map(log => [
                    log.timestamp,
                    log.action,
                    JSON.stringify(log.details || {}),
                    log.userAgent || ''
                ])
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gcl-logs-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearAllLogs() {
            if (confirm('Are you sure you want to clear all logs? This cannot be undone.')) {
                localStorage.removeItem('gclLogs');
                allLogs = [];
                filteredLogs = [];
                updateStats();
                displayLogs();
            }
        }

        // Auto-refresh every 30 seconds
        setInterval(loadLogs, 30000);
        
        // Initial load
        loadLogs();
    </script>
</body>
</html>